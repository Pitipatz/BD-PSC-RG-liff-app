<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</title>
</head>

<body>
  <h1>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠...</h1>

  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
  <script>
    const liffId = "2007110168-ZWgRXyVl";  // üëâ ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const googleFormUrl = "https://docs.google.com/forms/d/e/1FAIpQLSd4QOo285nRSaBu6H4fllVhRC2pnVByqMOwKpMyzBFjeKBDJw/viewform"; // üëâ ‡πÉ‡∏™‡πà Google Form URL

    async function initLiff() {
      try {
        await liff.init({ liffId });

        // üî• ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÉ‡∏´‡πâ login ‡∏û‡∏£‡πâ‡∏≠‡∏° Redirect ‡πÑ‡∏õ Google Form ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        if (!liff.isLoggedIn()) {
          liff.login({ redirectUri: googleFormUrl });
          return;  // ‚õî ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏£‡∏≠ Login ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ Google Form
        }

        // ‚úÖ ‡πÑ‡∏î‡πâ userProfile ‡∏´‡∏•‡∏±‡∏á login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        const profile = await liff.getProfile();
        const idToken = liff.getDecodedIDToken();
        let email = idToken?.email || ""; // ‡∏î‡∏∂‡∏á email ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ

        // ‚úÖ ‡πÉ‡∏ä‡πâ `?` ‡∏Å‡∏±‡∏ö Entry ‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ `&` ‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        const formUrl = googleFormUrl 
            + "?usp=pp_url"
            + "&entry.1786871077=" + encodeURIComponent(email)  // email
            + "&entry.328090191=" + encodeURIComponent(profile.userId)  // User ID
            + "&entry.1827052488=" + encodeURIComponent(profile.displayName)  // ‡∏ä‡∏∑‡πà‡∏≠
            + "&entry.1755252609=" + encodeURIComponent(profile.pictureUrl)  // ‡∏£‡∏π‡∏õ Profile
            + "&entry.1738595997=" + encodeURIComponent(profile.statusMessage);  // Status Message

        // üî• ‡πÄ‡∏õ‡∏¥‡∏î Google Form ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà Pre-Fill ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î Back
        window.location.replace(formUrl);

      } catch (err) {
        console.error("LIFF Error:", err);
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°");
      }
    }

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô LIFF
    initLiff();
  </script>

</body>
</html>
